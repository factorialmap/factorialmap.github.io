{
  "hash": "45a22c29fd4a2bd14d8cbd50618a14fa",
  "result": {
    "markdown": "---\ntitle: \"Como importar e visualizar dados - Titanic dataset parte1\"\nauthor: \"Marcelo Carvalho dos Anjos\"\ndate: \"2022-08-07\"\ncategories: [Exploração]\nimage: \"data_import.png\"\n---\n\n\n::: {.callout-tip appearance=\"simple\"}\nVídeo tema para este post em [YouTube Como importar e visualizar dados - Titanic dataset parte1](https://youtu.be/p-wiv5wnLMw){target=\"_blank\"}\n:::\n\n### {{< fa 1 >}} [**O que é importação e visualização de dados**]{style=\"color: #5AC8BE ;\"}\n\n-   É a etapa onde é feita extração de dados e avaliação se os mesmos podem contribuir para a solução do problema a ser resolvido.\n\n-   A visualização é uma forma intuitiva de traçar relações possíveis entre os dados e o desfecho permitindo a geração de questões e levantamento de hipóteses.\n\n-   Geralmente estão atrelados a uma métrica de sucesso e é feito após a etapa **P** do **PDCA** , **PPDAC** ou outro método de análise de fenõmeno e causa raíz utilizado.\n\n    ![Processo de projeto kaizen](data_import.png){width=\"658\"}\n\n### {{< fa 2 >}} [**Qual o objetivo**]{style=\"color: #5AC8BE ;\"}\n\n-   Disponibilizar recursos revelantes para solução dos problemas\n\n-   Filtrar dados relevantes dos não relevantes, entender a natureza dos dados se são realmente ruídos ou carecem de representação.\n\n-   Avaliar existencia de *shadow stats* ou se haverá dificuldade na coleta. Por exemplo: o dado pode ser muito relevante mas difícil de ser coletado ou pode haver muita instabilidade e ambiguidade ou até mesmo usar critérios diferentes entre diferentes fontes.\n\n-   Gerar novas questões e hipóteses que poderão utilizar novos dados ou um resultado de interação entre os existentes.\n\n### {{< fa 3 >}} [**De onde vem a demanda**]{style=\"color: #5AC8BE ;\"}\n\n-   A extração e visualização dos dados vem da necessidade de encontrar variáveis que expliquem o fenômeno e ajudem a prever eventos futuros.\n\n-   Melhorar e estimular a geração de ideias através da interação entre os envolvidos.\n\n### {{< fa 4 >}} [**Como fazer**]{style=\"color: #5AC8BE ;\"}\n\nPara reproduzir os códigos abaixo serão necessários os pacotes [tidyverse](https://www.tidyverse.org/){target=\"_blank\"} , [tidymodels](https://www.tidymodels.org/){target=\"_blank\"} e [janitor](https://github.com/sfirke/janitor){target=\"_blank\"}, [ggpubr](http://rpkgs.datanovia.com/ggpubr/index.html){target=\"_blank\"}, [funmodeling](http://pablo14.github.io/funModeling/articles/funModeling_quickstart.html){target=\"_blank\"}, [ggalluvial](https://cran.r-project.org/web/packages/ggalluvial/vignettes/ggalluvial.html){target=\"_blank\"} e [visdat](https://cran.r-project.org/web/packages/visdat/vignettes/using_visdat.html){target=\"_blank\"}\\\n\nO dados podem ser baixados no [Kaggle titanic dataset](https://www.kaggle.com/competitions/titanic/data){target=\"_blank\"}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# pacotes           --------------------------------------------------------\nlibrary(tidymodels)\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(ggpubr)\nlibrary(funModeling)\nlibrary(ggalluvial)\nlibrary(visdat)\n\n# dados             --------------------------------------------------------\n#importar os dados do kaggle e salvar em  diretorio padrão\n\n# importar dados e padronizar colunas\ntrain_titanic <- \n\tread.csv(\"train.csv\", na.strings = c(\"\",\" \")) %>% \n\tclean_names() %>% \n\tmutate(is_train = TRUE) \n\n#importar dados de teste\ntest_titanic <- \n  read.csv(\"test.csv\", na.strings = c(\"\",\" \")) %>% \n  clean_names() %>% \n  mutate(survived = NA, is_train = FALSE) \n\n#juntar os conjuntos\nsplit_titanic <- bind_rows(train_titanic, test_titanic)\n\n#check nas caracteristicas dos dados\nsplit_titanic %>% funModeling::df_status()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       variable q_zeros p_zeros q_na  p_na q_inf p_inf      type unique\n1  passenger_id       0    0.00    0  0.00     0     0   integer   1309\n2      survived     549   41.94  418 31.93     0     0   integer      2\n3        pclass       0    0.00    0  0.00     0     0   integer      3\n4          name       0    0.00    0  0.00     0     0 character   1307\n5           sex       0    0.00    0  0.00     0     0 character      2\n6           age       0    0.00  263 20.09     0     0   numeric     98\n7        sib_sp     891   68.07    0  0.00     0     0   integer      7\n8         parch    1002   76.55    0  0.00     0     0   integer      8\n9        ticket       0    0.00    0  0.00     0     0 character    929\n10         fare      17    1.30    1  0.08     0     0   numeric    281\n11        cabin       0    0.00 1014 77.46     0     0 character    186\n12     embarked       0    0.00    2  0.15     0     0 character      3\n13     is_train     418   31.93    0  0.00     0     0   logical      2\n```\n:::\n:::\n\n\nComo o nosso conjunto de dados é pequeno(tem poucas variáveis) é possível usar um gráfico para visualizar os tipos de dados e as características.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsplit_titanic %>% visdat::vis_dat()\n```\n\n::: {.cell-output-display}\n![](importar_visualizar_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n::: {.callout-tip collapse=\"true\"}\n## Como faço pra visualizar dados faltantes quando o conjunto for grande ?\n\n**Sugestão** É possível usar o pacote `naniar` com a função `naniar::miss_var_summary()`\n:::\n\nComo resultado da análise podemos verificar a necessidade de algumas transformações nos dados. Anotamos tudo para alterarmos posteriormente mas seguimos com a análise exploratória por enquanto.\n\n> Alterar o tipo de variável de `sex, embarked, survived, pclass = factor`\n>\n> Inserir dados faltantes em `embarked = moda, age e fare = usando knn`\n\nVamos fazer uma **correlação** para avaliar os padrões existentes. **Mas note**. Para fazer correlação, os dados precisam ser **numéricos** por isso usamos a função `select_if(is.numeric)` . Pelo padrão apresentado é possível verificar a existencia de dados categóricos `eles geralmente ficam espaçados no gráfico` e eles precisam ser transformados pra factor posteriormente e que já anotamos e comunicamos.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# correlacao\ntrain_titanic %>% \n  select_if(is.numeric) %>% \n  GGally::ggscatmat(color = \"survived\", corMethod = \"spearman\")+\n  theme_pubclean()\n```\n\n::: {.cell-output-display}\n![](importar_visualizar_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n**Será que a idade importa ?**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# age - será que a idade importa ? \ntrain_titanic %>% \n  ggplot(aes(x=age, fill = factor(survived)))+\n  geom_density(alpha =0.5)\n```\n\n::: {.cell-output-display}\n![](importar_visualizar_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n**Será que o sexo importa ?**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# age, sex and class - será que o sexo importa ?\ntrain_titanic %>% \n  ggplot(aes(x=pclass, fill= factor(survived)))+\n  geom_bar(stat = \"count\")+\n  facet_grid(~sex)\n```\n\n::: {.cell-output-display}\n![](importar_visualizar_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n**Vamos juntar as variáveis age+sex+pclass e analisar sob outro ponto de vista**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# age sex and class - sob outro ponto de vista\ntrain_titanic %>% \n  ggplot(aes(x=age, y=sex))+\n  geom_jitter(aes(color = factor(survived)))+\n  facet_wrap(~pclass)\n```\n\n::: {.cell-output-display}\n![](importar_visualizar_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n**Novamente vamos analisar sob outro ponto de vista**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# sex, class e survived \ntrain_titanic %>% \n  group_by(sex, survived, pclass) %>% \n  summarise(qtd = n()) %>% \n  ggplot(aes(axis1=sex, axis2=pclass, axis3 = survived, y=qtd, fill= sex))+\n  geom_alluvium()+\n  geom_stratum()+\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum)))+\n  scale_x_discrete(limits = c(\"sex\", \"pclass\",\"survived\"))\n```\n\n::: {.cell-output-display}\n![](importar_visualizar_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n**Será que a variável tarifa está bem representada ?**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# fare - será que fare é uma variável válida ?\ntrain_titanic %>% \n  mutate(fare = fare) %>% \n  ggplot(aes(x=fare, y=pclass))+\n  geom_jitter(aes(color = factor(survived)))\n```\n\n::: {.cell-output-display}\n![](importar_visualizar_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n**Sera que o tamanho da familia importa e o dado está bem representado ?**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# parch sib_sp - será que o tamanho da familia importa ?\ntrain_titanic %>% \n  mutate(family_size = parch + sib_sp +1) %>%\n  ggboxplot(x=\"survived\", \n            y=\"family_size\", \n            fill= \"survived\",\n            palette = \"uchicago\")+\n  stat_compare_means()\n```\n\n::: {.cell-output-display}\n![](importar_visualizar_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n**Será que existe algum padrão no nome que possa ser extraído e que ajude a explicar se impacta na sobrevivência ?**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# title\ntrain_titanic %>% \n  mutate(title = str_extract(name, \"[A-z]*\\\\.\")) %>% \n  tabyl(title) %>% \n  adorn_pct_formatting() %>% \n  arrange(desc(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     title   n percent\n       Mr. 517   58.0%\n     Miss. 182   20.4%\n      Mrs. 125   14.0%\n   Master.  40    4.5%\n       Dr.   7    0.8%\n      Rev.   6    0.7%\n      Col.   2    0.2%\n    Major.   2    0.2%\n     Mlle.   2    0.2%\n     Capt.   1    0.1%\n Countess.   1    0.1%\n      Don.   1    0.1%\n Jonkheer.   1    0.1%\n     Lady.   1    0.1%\n      Mme.   1    0.1%\n       Ms.   1    0.1%\n      Sir.   1    0.1%\n```\n:::\n:::\n\n\n### {{< fa 5 >}} [**Pra onde vai quem é o cliente**]{style=\"color: #5AC8BE ;\"}\n\n-   A próxima etapa é comunicar os resultados junto aos membros do projeto sobre as relações encontradas permitindo a interção e levantamento de novas necessidades ou hipóteses.\n\n-   Posteriormente, vem as etapas de pré processamento, modelo, validação e submissão.\n\n### {{< fa 6 >}} [**Qual o resultado**]{style=\"color: #5AC8BE ;\"}\n\n-   Aperfeiçoar a técnica de observação e representação de dados.\n\n-   Facilitar a comunicação com os envolvidos no projeto.\n\n-   Melhorar e estimular a geração de ideias através da interação entre os membros do projeto.\n",
    "supporting": [
      "importar_visualizar_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}